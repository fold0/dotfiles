#!/bin/bash
SCRIPT=$(realpath -P -- "${BASH_SOURCE[0]}")
source "${SCRIPT%/*}/lib.sh"

mkdir -m 0700 -p ~/.config/dconf ~/.config/mpv ~/.config/pulse

FLAGS=(
  ${X11_FLAGS[@]}
  --bind /run/user/$UID/pulse /run/user/$UID/pulse
  --ro-bind /etc /etc
  --ro-bind /usr/bin/mpv /usr/bin/mpv
  --ro-bind ~/.config/dconf ~/.config/dconf
  --ro-bind ~/.config/mpv ~/.config/mpv
  --ro-bind ~/.config/pulse ~/.config/pulse
  --unsetenv SESSION_MANAGER
)
add_nvidia
add_argdirs_ro "$@"

for arg in "$@"; do
  if [[ "$arg" =~ ^https?://.* ]]; then
    FLAGS+=(--share-net)
    break
  fi
done

exec bwrap "${FLAGS[@]}" /usr/bin/mpv "$@"
