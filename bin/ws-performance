#!/bin/bash
# Updates scaling governor to performance (or specified arg) for all CPUs.

GOVERNOR=${1:-performance}

for x in $(ls /sys/devices/system/cpu/cpufreq/policy*/scaling_governor | sort -V); do
  OLD_GOVERNOR="$(cat $x)"
  N=$(echo $x | egrep -o "[0-9]+")
  if [[ "$OLD_GOVERNOR" == "$GOVERNOR" ]]; then
    echo -n "$B$N "
    A=$": $GOVERNOR
"
    B=
  else
    echo -n "$A"
    A=
    if [[ $UID != 0 ]]; then
      echo Root access needed to modify state, re-running under sudo
      sudo $0 $*
      exit $?
    fi
    echo $GOVERNOR >$x
    echo -n "$N "
    B=": $OLD_GOVERNOR -> $GOVERNOR
"
  fi
done

echo -n "$A$B"
